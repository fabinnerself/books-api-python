> **Antecedente**: Tengo una **API RESTful en PHP/PostgreSQL** ya funcionando y publicada (ejemplo: [https://neophpgsql4.onrender.com](https://neophpgsql4.onrender.com)), y ahora necesito crear una **versiÃ³n moderna y escalable en Python**, diseÃ±ada para ejecutarse como **Web Service en [Render](https://render.com)**.
el direcotorio actual tiene su codigo 
>
> La nueva API debe gestionar el recurso `Book` con operaciones **CRUD completas**, **paginaciÃ³n**, **bÃºsqueda textual**, **filtrado avanzado** y **respuestas estandarizadas en JSON**. Debe conectarse a una base de datos **PostgreSQL local en desarrollo** y ser compatible con entornos de producciÃ³n (como Neon.tech o Render DB) mediante variables de entorno.
>
> El cÃ³digo debe ser **stateless**, compatible con arquitecturas sin estado (serverless), y seguir buenas prÃ¡cticas de seguridad, rendimiento, modularidad y mantenibilidad.

---

### ðŸ” **Credenciales de conexiÃ³n (entorno local)**

```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=library
DB_USER=postgres
DB_PASSWORD=1
DB_SSLMODE=disable
APP_ENV=development
APP_DEBUG=true
```

> âš ï¸ En producciÃ³n (Render), estas variables se configurarÃ¡n en el panel de entorno, **no en un archivo fÃ­sico**.

---

### ðŸ“¦ **Modelo de Datos: `Book` (Tabla `libros`)**

```sql
CREATE TABLE "libros" (
  "id_libro" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  "name" VARCHAR(255) NOT NULL,
  "author" VARCHAR(255) NOT NULL,
  "price" NUMERIC(10,2) NOT NULL,
  "description" TEXT,
  "created_at" TIMESTAMP DEFAULT now(),
  "updated_at" TIMESTAMP DEFAULT now(),
  "id_user" UUID,
  "is_deleted" BOOLEAN DEFAULT false,
  CONSTRAINT "fk_libros_usuario" 
    FOREIGN KEY ("id_user") 
    REFERENCES "usuarios"("id_user") 
    ON DELETE SET NULL
);
```

> âœ… Soporta **soft delete** (`is_deleted`).  
> âœ… `id_user` es opcional.  
> âœ… Todos los UUIDs se manejan como strings en Python.

---

### ðŸŒ **Endpoints Requeridos**

| MÃ©todo | Ruta | DescripciÃ³n |
|-------|------|-------------|
| `GET` | `/api/v1/health` | Estado de la API |
| `GET` | `/api/v1/books` | Listado con paginaciÃ³n, bÃºsqueda (`q`), y filtros (`min_price`, `max_price`, `author`) |
| `GET` | `/api/v1/books/{id}` | Obtener libro por UUID |
| `POST` | `/api/v1/books` | Crear libro (validaciones de entrada) |
| `PUT` | `/api/v1/books/{id}` | Actualizar libro (campos permitidos) |
| `DELETE` | `/api/v1/books/{id}` | Soft delete (`is_deleted = true`) |

#### Ejemplo de respuesta exitosa
```json
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 150,
    "total_pages": 15
  }
}
```

#### Ejemplo de error
```json
{
  "success": false,
  "error": "Book not found",
  "code": 404
}
```

---

### ðŸ **TecnologÃ­as y Herramientas**

| Capa | TecnologÃ­a recomendada |
|------|------------------------|
| **Framework** | FastAPI (recomendado por su velocidad, Pydantic y soporte ASGI) |
| **Base de datos** | PostgreSQL (local o en la nube: Neon.tech o Render DB) |
| **ConexiÃ³n BD** | `SQLAlchemy 2.0` + `asyncpg` (modo asÃ­ncrono) o `psycopg2` (modo sÃ­ncrono) |
| **ValidaciÃ³n** | `Pydantic` (esquemas de entrada/salida) |
| **UUIDs** | `uuid` (librerÃ­a estÃ¡ndar de Python) |
| **Variables de entorno** | `python-dotenv` |
| **Zona horaria** | UTC (`from datetime import datetime, timezone`) |
| **DocumentaciÃ³n** | Swagger UI / Redoc (FastAPI lo incluye por defecto) |

---

### ðŸ“ **Estructura del Proyecto (EstÃ¡ndar y Escalable)**

```
/
â”œâ”€â”€ api/                      # Endpoints
â”‚   â”œâ”€â”€ health.py
â”‚   â””â”€â”€ books.py
â”œâ”€â”€ controllers/             # LÃ³gica de negocio
â”‚   â””â”€â”€ book_controller.py
â”œâ”€â”€ models/                  # Modelos SQLAlchemy
â”‚   â””â”€â”€ book_model.py
â”œâ”€â”€ schemas/                 # Esquemas Pydantic
â”‚   â””â”€â”€ book_schema.py
â”œâ”€â”€ config/                  # ConfiguraciÃ³n
â”‚   â”œâ”€â”€ database.py          # ConexiÃ³n asÃ­ncrona a PostgreSQL
â”‚   â””â”€â”€ settings.py          # Carga de variables de entorno
â”œâ”€â”€ scripts/                 # Scripts de BD
â”‚   â”œâ”€â”€ create_tables.sql
â”‚   â””â”€â”€ seed_data.py
â”œâ”€â”€ .env
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml       # Para desarrollo local (API + PostgreSQL)
â”œâ”€â”€ requirements.txt         # Dependencias
â”œâ”€â”€ render.yaml              # Despliegue automÃ¡tico en Render
â”œâ”€â”€ main.py                  # Punto de entrada
â””â”€â”€ README.md
```

---

### ðŸ³ **Docker: ConstrucciÃ³n y EjecuciÃ³n del Contenedor**

#### 1. Crear la imagen Docker

```bash
docker build -t books-api .
```

#### 2. Ejecutar el contenedor (modo desarrollo)

```bash
docker run -d -p 8000:8000 books-api
```

> Accede a la API en: `http://localhost:8000/api/v1/health`  
> Accede a la documentaciÃ³n en: `http://localhost:8000/docs`

#### 3. Ejecutar con variables de entorno

```bash
docker run -d \
  -p 8000:8000 \
  -e DB_HOST=localhost \
  -e DB_PORT=5432 \
  -e DB_NAME=library \
  -e DB_USER=postgres \
  -e DB_PASSWORD=1 \
  -e DB_SSLMODE=disable \
  books-api
```

#### 4. Comandos Ãºtiles de Docker

```bash
# Listar contenedores
docker ps

# Ver logs
docker logs <container_id>

# Detener contenedor
docker stop <container_id>

# Eliminar contenedor
docker rm <container_id>

# Listar imÃ¡genes
docker image ls

# Eliminar imagen
docker rmi books-api
```

---

### â˜ï¸ **Despliegue en Render**

#### `render.yaml` (configuraciÃ³n automÃ¡tica)

```yaml
services:
  - type: web
    name: python-book-api
    runtime: docker
    envVars:
      - key: DB_HOST
        value: localhost
      - key: DB_PORT
        value: 5432
      - key: DB_NAME
        value: library
      - key: DB_USER
        value: postgres
      - key: DB_PASSWORD
        value: 1
      - key: DB_SSLMODE
        value: disable
      - key: APP_ENV
        value: production
    plan: free
```

> âœ… Render ejecutarÃ¡ automÃ¡ticamente `docker build` y `docker run` usando el `Dockerfile` y `render.yaml`.  
> âœ… El puerto debe ser `10000` si se usa `render.yaml` (ajusta el `CMD` en el Dockerfile).

---

### ðŸ“¦ **Entrega Esperada**

- âœ… CÃ³digo modular, limpio, con comentarios y manejo de errores.
- âœ… Compatible con Python 3.9+.
- âœ… Funciona localmente con `docker-compose up`.
- âœ… Listo para desplegar en Render con `render.yaml`.
- âœ… Incluye `.gitignore` (ignora `.env`, `__pycache__`, etc.).
- âœ… `README.md` con:
  - GuÃ­a de instalaciÃ³n (`pip install -r requirements.txt`)
  - CÃ³mo correr localmente (`uvicorn main:app --reload`)
  - Endpoints y ejemplos con `curl`
  - Variables de entorno
  - Instrucciones para despliegue en Render
- âœ… Ejemplos de uso:
  ```bash
  curl -X GET "http://localhost:8000/api/v1/books?page=1&limit=5&q=sabato"
  curl -X POST "http://localhost:8000/api/v1/books" \
    -H "Content-Type: application/json" \
    -d '{
      "name": "Rayuela",
      "author": "Julio CortÃ¡zar",
      "price": 22.50,
      "description": "Una novela experimental Ãºnica."
    }'
  ```

---

### ðŸŽ¯ **Objetivo Final**

Crear una **API robusta, moderna y lista para producciÃ³n**, que sea el reemplazo natural de la versiÃ³n en PHP, con mejoras en rendimiento, claridad y escalabilidad, usando el ecosistema de Python, PostgreSQL y Render.

Ideal para integrar con frontends, mÃ³viles o microservicios, y escalable a millones de peticiones gracias a FastAPI y Render.
